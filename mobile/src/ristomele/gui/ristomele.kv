#:import ListAdapter kivy.adapters.listadapter.ListAdapter
#:import Factory kivy.factory.Factory
#:import get_color_from_hex kivy.utils.get_color_from_hex
#:import icon kivy.garden.iconfonts.icon
#:import XCamera kivy.garden.xcamera.XCamera
#:import darker kivy.garden.xcamera.darker
#:import Theme ristomele.gui.uix.Theme

# =====================================================================
# common styles
# =====================================================================


<FlatButton>:
    background_color: (1, 1, 1, 1)
    _down_color: darker(self.background_color)
    color: Theme.ICON
    show_border: False

    canvas.before:
        Color:
            rgba: self.background_color if self.state == 'normal' else self._down_color

        Rectangle:
            pos: self.pos
            size: self.size

        Color:
            rgba: Theme.SEPARATOR if self.show_border else Theme.TRANSPARENT

        Line:
            rectangle: self.x+1,self.y+1,self.width-1,self.height-1


<IconButton@FlatButton>:
    icon: ""
    markup: True
    color: Theme.ICON
    text: icon(self.icon) if self.icon else ""
    size_hint_x: None
    width: self.height

# ==========
# main menu
# ==========

<MainScreen>:
    BoxLayout:
        orientation: 'vertical'

        MyLabel:
            text: "Menu Principale"
            size_hint_y: None
            height: "50dp"

        FlatButton:
            text: "Mappa tavoli"
            show_border: True
            on_release: app.show_tables()

        FlatButton:
            text: "Lista ordini"
            show_border: True

        FlatButton:
            text: "Configura tavoli"
            show_border: True
            on_release: app.edit_tables()

        FlatButton:
            text: "Opzioni"
            show_border: True


# =====================================================================
# tables.py
# =====================================================================

<TableButton>:
    canvas.after:
        Color:
            rgba: Theme.MUTED

        Line:
            rectangle: self.x,self.y,self.width,self.height
            # dash_offset: 5
            # dash_length: 3

    background_color: Theme.DANGER if self.table.busy else Theme.SUCCESS
    text: self.table.name
    on_release: app.new_order(self.table)


<TablesScreen>:
    BoxLayout:
        id: layout
        orientation: 'vertical'

        MyLabel:
            text: "Mappa dei tavoli"
            size_hint_y: None
            height: '50dp'


<EditableTable>:
    canvas.after:
        Color:
            rgba: Theme.SEPARATOR

        Line:
            rectangle: self.x+1,self.y+1,self.width-1,self.height-1

    FlatButton:
        id: main_button
        text: '%s\n%s' % (root.table.name, root.table.waiter)

    IconButton:
        id: load_button
        icon: 'fa-upload'
        size_hint_y: None
        height: '30dp'


<EditTablesScreen>:
    BoxLayout:
        id: layout
        orientation: 'vertical'

        MyLabel:
            text: "Modifica tavoli"
            size_hint_y: None
            height: '50dp'

        TextInput: 
            id: waiter_name
            hint_text: 'Nome cameriere'
            size_hint_y: None
            height: '30dp'
            multiline: False


# =====================================================================
# order.py
# =====================================================================

<MenuItem>:
    orientation: 'horizontal'
    height: '30dp'
    size_hint_y: None

    MyLabel:
        text: root.item.name
        text_size: self.size
        padding_x: 20
        size_hint_x: 0.75

    BoxLayout:
        orientation: 'horizontal'
        size_hint_x: 0.25
        IconButton:
            icon: 'fa-minus-square'
            color: Theme.MUTED
            on_release: root.item.count = max(root.item.count-1, 0)

        MyLabel:
            text: str(root.item.count)

        IconButton:
            icon: 'fa-plus-square'
            color: Theme.MUTED
            on_release: root.item.count += 1

<MenuSeparator>:
    orientation: 'horizontal'
    height: '30dp'
    size_hint_y: None
    MyLabel:
        text: root.item.name
        text_size: self.size
        padding_x: 10
        color: (0, 0, 0, 1)

<NewOrderScreen>:
    BoxLayout:
        id: layout
        orientation: 'vertical'

        MyLabel:
            text: "Tavolo: %s" % root.order.table.name
            size_hint_y: None
            height: '50dp'

        TextInput:
            id: customer_name
            hint_text: 'Nome'
            size_hint_y: None
            height: '30dp'
            multiline: False

        TextInput:
            id: notes
            hint_text: 'Note'
            size_hint_y: None
            height: '30dp'
            multiline: False

        ListView:
            id: item_list
            adapter: ListAdapter(data=root.order.menu, cls=root.item_class, args_converter=lambda i, x: {'x': x})

        BoxLayout:
            id: layout
            orientation: 'horizontal'
            height: '40dp'
            size_hint_y: None

            Button:
                text: "OK"
                size_hint_y: None
                height: '40dp'
                on_release: root.submit(app)

            Button:
                text: "Indietro"
                size_hint_y: None
                height: '40dp'
                on_release: app.root.go_back()



<ShowOrderScreen>:
    BoxLayout:
        id: layout
        orientation: 'vertical'

        MyLabel:
            text: "Riepilogo ordine"
            size_hint_y: None
            height: '50dp'

        ScrollView:
            size_hint_y: 1
            Label:
                id: content
                text: root.order.as_textual_receipt()
                height: self.texture_size[1]
                size_hint_y: None
                color: (0, 0, 0, 1)
                font_name: 'RobotoMono-Regular'

        BoxLayout:
            id: layout
            orientation: 'horizontal'
            height: '40dp'
            size_hint_y: None

            Button:
                text: "Invia"
                size_hint_y: None
                height: '40dp'
                on_release: root.submit(app)

            Button:
                text: "Indietro"
                size_hint_y: None
                height: '40dp'
                on_release: app.root.go_back()
